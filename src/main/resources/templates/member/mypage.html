<!DOCTYPE html>
<html layout:decorate="~{layout}"> <!-- layout.html 상속 -->

<div layout:fragment="content">
  <style>
    .profile-image-wrapper {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .profile-image {
      border-radius: 50%;
      width: 150px;
      height: 150px;
      object-fit: cover;
    }
    .form-group {
      margin-bottom: 20px;
    }
  </style>

  <script>
    window.onload = () => {
      // Enter key event listeners for each input field
      document.querySelector('#id').addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
          document.getElementById('email').focus();
        }
      });

      document.querySelector('#email').addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
          document.getElementById('nickname').focus();
        }
      });

      document.querySelector('#nickname').addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
          document.getElementById('btn_DaumPostcode').focus();
        }
      });

      document.querySelector('#address2').addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
          document.getElementById('pf_imgMF').focus();
        }
      });
    }

    // Daum Postcode API
    function DaumPostcode() {
      var element_wrap = document.getElementById('wrap');
      var currentScroll = Math.max(document.body.scrollTop, document.documentElement.scrollTop);
      new daum.Postcode({
        oncomplete: function(data) {
          var addr = '';
          if (data.userSelectedType === 'R') {
            addr = data.roadAddress;
          } else {
            addr = data.jibunAddress;
          }
          document.getElementById('zipcode').value = data.zonecode;
          document.getElementById("address1").value = addr;
          document.getElementById("address2").value = "";
          document.getElementById("address2").focus();
          element_wrap.style.display = 'none';
          document.body.scrollTop = currentScroll;
        },
        onresize: function(size) {
          element_wrap.style.height = size.height + 'px';
        },
        width: '100%',
        height: '100%'
      }).embed(element_wrap);
      element_wrap.style.display = 'block';
    }
  </script>

  <div class="title_line">마이페이지</div>
  <aside class="aside_right">
    <a href="javascript:location.reload();">새로고침</a>
    <span class='menu_divide'>│</span> 
    <a th:href="@{/member/mypage}">개인정보 수정</a>
    <span class='menu_divide'>│</span> 
    <a th:href="@{/member/inquiries}">문의글</a>
    <span class='menu_divide'>│</span> 
    <a th:href="@{/member/delete_account}">회원 탈퇴</a>
  </aside>

  <div class='menu_line'></div>

  <div style="width: 60%; margin: 0px auto">
    <form name="frm" id="frm" th:object="${memberVO}" method="post" th:action="@{/member/mypage}" enctype="multipart/form-data">
      <div class="form-group">
        <div class="profile-image-wrapper">
          <div class="profile-image" th:if="${memberVO.file1saved != 'default.png' and (memberVO.file1saved.endsWith('jpg') or memberVO.file1saved.endsWith('png') or memberVO.file1saved.endsWith('gif'))}">
            <img th:src="@{|/member/storage/${memberVO.file1saved}|}" class="profile-image">
          </div>
          <div class="profile-image" th:if="${memberVO.file1saved == 'default.png' or memberVO.size1 == 0}">
            <img th:src="@{/images/default.png}" class="profile-image">
          </div>
        </div>
        <label for="pf_imgMF">프로필 이미지 변경</label>
        <input type='file' name='pf_imgMF' id='pf_imgMF' class="form-control">
      </div>

      <div class="form-group">
        <label for="id">아이디*</label>
        <input type="text" name="id" id="id" th:value="${memberVO.id}" class="form-control form-control-sm" readonly style="width: 50%;">
      </div>

      <div class="form-group">
        <label for="email">이메일*</label>
        <input type="email" name="email" id="email" th:value="${memberVO.email}" class="form-control form-control-sm" style="width: 50%;">
      </div>

      <div class="form-group">
        <label for="nickname">닉네임</label>
        <input type='text' name='nickname' id='nickname' th:value="${memberVO.nickname}" placeholder="닉네임" class="form-control form-control-sm" style="width: 30%;">
        예) 뷰티풀
      </div>

      <div class="form-group">
        <label for="zipcode">우편 번호</label>
        <input type='text' name='zipcode' id='zipcode' th:value="${memberVO.zipcode}" placeholder="우편번호" class="form-control form-control-sm" style="width: 30%;">
        <button type="button" id="btn_DaumPostcode" onclick="DaumPostcode()" class="btn btn-primary btn-sm" style="margin-top: 4px;">우편번호 찾기</button>
      </div>

      <div class="form-group">
        <label for="address1" style="width: 100%;">주소</label>
        <input type='text' name='address1' id='address1' th:value="${memberVO.address1}" placeholder="주소" class="form-control form-control-sm">
      </div>

      <div class="form-group">
        <label for="address2" style="width: 100%;">상세 주소</label>
        <input type='text' name='address2' id='address2' th:value="${memberVO.address2}" placeholder="상세 주소" class="form-control form-control-sm">
      </div>

      <div class="form-group">
        <label for="current_passwd">현재 비밀번호</label>
        <input type="password" name="current_passwd" id="current_passwd" class="form-control form-control-sm" style="width: 50%;">
      </div>

      <div class="form-group">
        <label for="new_passwd">새 비밀번호</label>
        <input type="password" name="new_passwd" id="new_passwd" class="form-control form-control-sm" style="width: 50%;">
      </div>

      <div class="content_body_bottom">
        <button type="submit" class="btn btn-primary btn-sm">프로필 수정</button>
        <button type="button" onclick="history.back();" class="btn btn-secondary btn-sm">취소</button>
      </div>
      
      <!-- ------------------------------ DAUM 우편번호 API 시작 ------------------------------ -->
      <div>
          <div id="wrap" style="display:none;border:1px solid;width:500px;height:300px;margin:5px 0;position:relative">
              <img src="//t1.daumcdn.net/postcode/resource/images/close.png" id="btnFoldWrap" style="cursor:pointer;position:absolute;right:0px;top:-1px;z-index:1" onclick="foldDaumPostcode()" alt="접기 버튼">
          </div>

          <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
          <script>
              // 우편번호 찾기 찾기 화면을 넣을 element
              var element_wrap = document.getElementById('wrap');

              function foldDaumPostcode() {
                  // iframe을 넣은 element를 안보이게 한다.
                  element_wrap.style.display = 'none';
              }

              function DaumPostcode() {
                  // 현재 scroll 위치를 저장해놓는다.
                  var currentScroll = Math.max(document.body.scrollTop, document.documentElement.scrollTop);
                  new daum.Postcode({
                      oncomplete: function(data) {
                          // 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                          // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                          // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                          var addr = ''; // 주소 변수
                          var extraAddr = ''; // 참고항목 변수

                          //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
                          if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
                              addr = data.roadAddress;
                          } else { // 사용자가 지번 주소를 선택했을 경우(J)
                              addr = data.jibunAddress;
                          }

                          // 우편번호와 주소 정보를 해당 필드에 넣는다.
                          document.getElementById('zipcode').value = data.zonecode; // 우편번호
                          document.getElementById("address1").value = addr;  // 주소

                          document.getElementById("address2").value=""; // 상세 주소 지우기
                          // 커서를 상세주소 필드로 이동한다.
                          document.getElementById("address2").focus();  // 상세 주소로 포커스 이동

                          // iframe을 넣은 element를 안보이게 한다.
                          // (autoClose:false 기능을 이용한다면, 아래 코드를 제거해야 화면에서 사라지지 않는다.)
                          element_wrap.style.display = 'none';

                          // 우편번호 찾기 화면이 보이기 이전으로 scroll 위치를 되돌린다.
                          document.body.scrollTop = currentScroll;
                      },
                      // 우편번호 찾기 화면 크기가 조정되었을때 실행할 코드를 작성하는 부분. iframe을 넣은 element의 높이값을 조정한다.
                      onresize : function(size) {
                          element_wrap.style.height = size.height+'px';
                      },
                      width : '100%',
                      height : '100%'
                  }).embed(element_wrap);

                  // iframe을 넣은 element를 보이게 한다.
                  element_wrap.style.display = 'block';
              }
          </script>
      </div>
      <!-- ------------------------------ DAUM 우편번호 API 종료 ------------------------------ -->
    </form>
  </div>
</div>

</html>